<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê²€ìƒ‰ ê²°ê³¼</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <h2>ğŸ¬ ê²€ìƒ‰ ê²°ê³¼</h2>
  <ul id="search-result"></ul>

  <script>
    const tmdbKey = '234ef78df71e08e515ca2d691678e0f1';
    const kobisKey = '455015aa3f97520437568b039887193b';

    // URLì—ì„œ query íŒŒë¼ë¯¸í„° ê°€ì ¸ì˜¤ê¸°
    const params = new URLSearchParams(window.location.search);
    const query = params.get('query');

    if (query) {
      // KOBIS ì˜í™” ê²€ìƒ‰
      $.ajax({
        url: 'https://www.kobis.or.kr/kobisopenapi/webservice/rest/movie/searchMovieList.json',
        type: 'GET',
        data: {
          key: kobisKey,
          movieNm: query
        },
        success: function (data) {
          const list = data.movieListResult.movieList.slice(0, 10);
          if (list.length === 0) {
            $('#search-result').append('<li>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</li>');
          } else {
            list.forEach(movie => {
              fetchPoster(movie.movieNm, movie.prdtYear, function (posterUrl) {
                const posterImg = posterUrl ? `<img src="${posterUrl}" width="80" />` : '';
                $('#search-result').append(`<li>${posterImg} <strong>${movie.movieNm}</strong> (${movie.prdtYear})</li>`);
              });
            });
          }
        },
        error: err => console.error('KOBIS ì—ëŸ¬:', err)
      });
    }

    // TMDB í¬ìŠ¤í„° ê°€ì ¸ì˜¤ê¸°
    function fetchPoster(title, year, callback) {
      $.ajax({
        url: 'https://api.themoviedb.org/3/search/movie',
        type: 'GET',
        data: {
          api_key: tmdbKey,
          query: title,
          year: year,
          language: 'ko'
        },
        success: function (res) {
          const posterPath = res.results[0]?.poster_path;
          callback(posterPath ? `https://image.tmdb.org/t/p/w200${posterPath}` : null);
        },
        error: err => {
          console.error('TMDB ì—ëŸ¬:', err);
          callback(null);
        }
      });
    }
  </script>
</body>
</html>
