<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ÏòàÎß§ Ìã∞Ïºì</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      background: #f7f7f7;
      font-family: 'Segoe UI', sans-serif;
      color: #333;
      margin: 0;
    }

    .ticket {
      max-width: 600px;
      margin: 50px auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
      overflow: hidden;
      position: relative;
    }

    .banner {
      position: relative;
      height: 220px;
      overflow: hidden;
    }

    .banner img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .banner::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 60%;
      background: linear-gradient(to top, white, rgba(255, 255, 255, 0));
    }

    .ticket-content {
      padding: 30px;
      padding-bottom: 50px;
      z-index: 2;
    }

    .poster {
      width: 100px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.15);
      float: left;
      margin-right: 20px;
    }

    .ticket-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-top: 10px;
    }

    .ticket-info {
      overflow: hidden;
    }

    .info-item {
      margin-bottom: 8px;
    }

    .label {
      font-weight: 600;
      color: #777;
    }

    .value {
      color: #333;
    }

    .divider {
      border-top: 1px dashed #ccc;
      margin: 25px 0;
    }

    .qr {
      display: block;
      width: 100px;
      margin: 20px auto 10px;
    }

    .price {
      text-align: right;
      font-size: 1.4rem;
      font-weight: 700;
      color: #e91e63;
    }

    .button-group {
      text-align: center;
      margin-top: 30px;
    }

    .btn-custom {
      margin: 5px;
      padding: 10px 20px;
      font-weight: 600;
      border-radius: 10px;
    }

    @media (max-width: 576px) {
      .poster {
        float: none;
        display: block;
        margin: 0 auto 15px;
      }

      .ticket-info {
        text-align: center;
      }

      .price {
        text-align: center;
        margin-top: 10px;
      }
    }
  </style>
</head>
<body>
  <div id="ticket" class="ticket">
    <div class="banner">
      <img id="banner" src="" alt="ÏòÅÌôî Î∞∞ÎÑà">
    </div>
    <div class="ticket-content">
      <div class="ticket-info">
        <img id="poster" class="poster" src="" alt="ÏòÅÌôî Ìè¨Ïä§ÌÑ∞">
        <div>
          <div class="ticket-title" id="movie-title">ÏòÅÌôî Ï†úÎ™©</div>
          <div class="info-item"><span class="label">ÏÉÅÏòÅÍ¥Ä:</span> <span class="value" id="theater"></span></div>
          <div class="info-item"><span class="label">ÏùºÏãú:</span> <span class="value" id="datetime"></span></div>
          <div class="info-item"><span class="label">Ï¢åÏÑù:</span> <span class="value" id="seats"></span></div>
          <div class="info-item"><span class="label">Ïù∏Ïõê:</span> <span class="value" id="people"></span></div>
        </div>
      </div>
      <div class="divider"></div>
      <div class="price"><span id="price"></span> Ïõê</div>
      <img class="qr" src="https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=MEGABOX-TICKET" alt="QR ÏΩîÎìú">
    </div>
  </div>

  <div class="button-group">
    <button class="btn btn-outline-primary btn-custom" onclick="downloadPDF()">üìÑ PDF Ï†ÄÏû•</button>
    <a href="index.html" class="btn btn-outline-dark btn-custom">üè† ÌôàÏúºÎ°ú</a>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const movie = params.get('movie');
    const theater = params.get('theater');
    const date = params.get('date');
    const time = params.get('time');
    const seats = params.get('seats');
    const adult = parseInt(params.get('adult'));
    const teen = parseInt(params.get('teen'));
    const discount = parseInt(params.get('discount'));
    const price = parseInt(params.get('price')).toLocaleString();

    const formattedDate = date.replace(/(\d{4})(\d{2})(\d{2})/, '$1.$2.$3');
    const formattedTime = time.replace(/(\d{2})(\d{2})/, '$1:$2');

    const people = [];
    if (adult) people.push(`ÏÑ±Ïù∏ ${adult}Î™Ö`);
    if (teen) people.push(`Ï≤≠ÏÜåÎÖÑ ${teen}Î™Ö`);
    if (discount) people.push(`Ïö∞ÎåÄ ${discount}Î™Ö`);

    document.getElementById('movie-title').textContent = movie;
    document.getElementById('theater').textContent = theater;
    document.getElementById('datetime').textContent = `${formattedDate} ${formattedTime}`;
    document.getElementById('seats').textContent = seats;
    document.getElementById('people').textContent = people.join(', ');
    document.getElementById('price').textContent = price;

    // ÏòÅÌôî Ïù¥ÎØ∏ÏßÄ Î∂àÎü¨Ïò§Í∏∞
    fetch(`https://api.themoviedb.org/3/search/movie?api_key=234ef78df71e08e515ca2d691678e0f1&query=${encodeURIComponent(movie)}&language=ko`)
      .then(res => res.json())
      .then(data => {
        const movieData = data.results[0];
        if (movieData) {
          const posterPath = movieData.poster_path;
          const backdropPath = movieData.backdrop_path;
          if (posterPath) {
            document.getElementById('poster').src = `https://image.tmdb.org/t/p/w300${posterPath}`;
          }
          if (backdropPath) {
            document.getElementById('banner').src = `https://image.tmdb.org/t/p/w780${backdropPath}`;
          }
        }
      });

    function downloadPDF() {
      const ticket = document.getElementById("ticket");
      const opt = {
        margin: 0,
        filename: 'ÏòàÎß§Ìã∞Ïºì.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
      };
      html2pdf().set(opt).from(ticket).save();
    }
  </script>
</body>
</html>
